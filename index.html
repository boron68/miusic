// server.js
const http = require('http');
const fs = require('fs');
const path = require('path');

const PORT = process.env.PORT || 3000;

const server = http.createServer((req, res) => {

  // Ð’Ð¸Ð´Ð°Ñ”Ð¼Ð¾ index.html
  if (req.url === "/" || req.url === "/admin") {
    const filePath = path.join(__dirname, "index.html");

    fs.readFile(filePath, (err, data) => {
      if (err) {
        res.writeHead(500, { "Content-Type": "text/plain" });
        return res.end("index.html Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾");
      }

      res.writeHead(200, { "Content-Type": "text/html" });
      return res.end(data);
    });
    return;
  }

  // ÐŸÑ€Ð¸Ð¹Ð¼Ð°Ñ”Ð¼Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ enable / disable
  if (req.url === "/maintenance" && req.method === "POST") {
    let body = "";

    req.on("data", chunk => body += chunk);
    req.on("end", () => {
      try {
        const json = JSON.parse(body);

        console.log("ÐšÐ¾Ð¼Ð°Ð½Ð´Ð°:", json.action);

        if (json.action === "enable") {
          res.end("Ð¢ÐµÑ…Ð½Ñ–Ñ‡Ð½Ðµ Ð¾Ð±ÑÐ»ÑƒÐ³Ð¾Ð²ÑƒÐ²Ð°Ð½Ð½Ñ ÑƒÐ²Ñ–Ð¼ÐºÐ½ÐµÐ½Ð¾");
        } else if (json.action === "disable") {
          res.end("Ð¢ÐµÑ…Ð½Ñ–Ñ‡Ð½Ðµ Ð¾Ð±ÑÐ»ÑƒÐ³Ð¾Ð²ÑƒÐ²Ð°Ð½Ð½Ñ Ð²Ð¸Ð¼ÐºÐ½ÐµÐ½Ð¾");
        } else {
          res.end("ÐÐµÐ²Ñ–Ð´Ð¾Ð¼Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°");
        }

      } catch (err) {
        res.writeHead(400);
        res.end("ÐÐµÐ²Ñ–Ñ€Ð½Ð¸Ð¹ JSON");
      }
    });
    return;
  }

  // Ð—Ð°Ð³Ð»ÑƒÑˆÐºÐ°
  res.writeHead(200, { "Content-Type": "text/plain" });
  res.end("OK");
});

server.listen(PORT, () => {
  console.log(`ðŸš€ Server running on port ${PORT}`);
});
